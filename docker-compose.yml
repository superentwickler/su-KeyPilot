# KeyPilot – Installation mit Docker Compose
# Nach dem Start: Frontend unter http://localhost (Standard Port 80, über FRONTEND_PORT änderbar)
# Projektname in Docker Desktop: su-KeyPilot (unabhängig vom Ordner)

name: su-KeyPilot

services:
  backend:
    build: ./backend
    container_name: keypilot-backend
    ports:
      - "${BACKEND_PORT:-8000}:8000"
    volumes:
      # Speicherort der DB auf dem Host (Standard: ./backend/data). Z.B. iCloud/OneDrive-Ordner möglich – siehe README.
      - "${KEYPILOT_DATA_DIR:-./backend/data}:/app/data"
    environment:
      - DATABASE_URL=sqlite+aiosqlite:///./data/keypilot.db
      - KEYPILOT_DATA_DIR=${KEYPILOT_DATA_DIR:-}
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL:-http://host.docker.internal:11434}
      - OLLAMA_MODEL=${OLLAMA_MODEL:-llama3.2}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped

  frontend:
    build: ./frontend
    container_name: keypilot-frontend
    ports:
      - "${FRONTEND_PORT:-80}:80"
    depends_on:
      - backend
    restart: unless-stopped
