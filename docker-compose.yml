# KeyPilot â€“ Docker Compose
# After start: frontend at http://localhost (default port 80; set FRONTEND_PORT to change).
# Project name in Docker Desktop: su-KeyPilot.

name: su-KeyPilot

services:
  backend:
    build: ./backend
    container_name: keypilot-backend
    ports:
      - "${BACKEND_PORT:-8000}:8000"
    volumes:
      # DB location on host (default: ./backend/data). Set KEYPILOT_DATA_DIR in project root .env.
      - "${KEYPILOT_DATA_DIR:-./backend/data}:/app/data"
    environment:
      # Container uses /app/data (mount point); host path for display only
      - KEYPILOT_DATA_DIR=/app/data
      - KEYPILOT_DATA_DIR_DISPLAY=${KEYPILOT_DATA_DIR:-./backend/data}
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL:-http://host.docker.internal:11434}
      - OLLAMA_MODEL=${OLLAMA_MODEL:-llama3.2}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped

  frontend:
    build: ./frontend
    container_name: keypilot-frontend
    ports:
      - "${FRONTEND_PORT:-80}:80"
    depends_on:
      - backend
    restart: unless-stopped
